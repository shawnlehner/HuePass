---
/**
 * Main Color Contrast Checker Tool
 * Real-time WCAG contrast ratio calculation with live preview
 */
---

<section class="contrast-checker" id="contrast-checker">
  <div class="tool-header">
    <h2 class="tool-title">Check Color Contrast</h2>
    <p class="tool-description">
      Enter your foreground and background colors to instantly check WCAG compliance
    </p>
  </div>

  <div class="checker-grid">
    <!-- Color Inputs -->
    <div class="color-inputs-card card">
      <div class="color-inputs">
        <div class="color-input-group">
          <label class="color-label" for="foreground-color">
            <span class="label-text">Foreground</span>
            <span class="label-hint">Text color</span>
          </label>
          <div class="color-input-wrapper">
            <input
              type="color"
              id="foreground-picker"
              class="color-picker"
              value="#FAFAFA"
              aria-label="Foreground color picker"
            />
            <input
              type="text"
              id="foreground-color"
              class="input color-hex-input"
              value="#FAFAFA"
              placeholder="#FAFAFA"
              maxlength="7"
              spellcheck="false"
              autocomplete="off"
            />
          </div>
        </div>

        <button class="btn btn-icon swap-btn" id="swap-colors" aria-label="Swap foreground and background colors">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/>
          </svg>
        </button>

        <div class="color-input-group">
          <label class="color-label" for="background-color">
            <span class="label-text">Background</span>
            <span class="label-hint">Surface color</span>
          </label>
          <div class="color-input-wrapper">
            <input
              type="color"
              id="background-picker"
              class="color-picker"
              value="#0A0A0B"
              aria-label="Background color picker"
            />
            <input
              type="text"
              id="background-color"
              class="input color-hex-input"
              value="#0A0A0B"
              placeholder="#0A0A0B"
              maxlength="7"
              spellcheck="false"
              autocomplete="off"
            />
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn" id="random-pair">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="20" rx="2"/>
            <circle cx="8" cy="8" r="1.5"/>
            <circle cx="16" cy="8" r="1.5"/>
            <circle cx="8" cy="16" r="1.5"/>
            <circle cx="16" cy="16" r="1.5"/>
            <circle cx="12" cy="12" r="1.5"/>
          </svg>
          Random Pair
        </button>
        <button class="btn btn-primary" id="add-to-palette">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add to Palette
        </button>
      </div>

      <!-- CVD Preview (shown when no simulation active) -->
      <div class="cvd-preview-panel" id="cvd-preview-panel">
        <div class="cvd-preview-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="12" cy="12" r="4"/>
            <line x1="21.17" y1="8" x2="12" y2="8"/>
            <line x1="3.95" y1="6.06" x2="8.54" y2="14"/>
            <line x1="10.88" y1="21.94" x2="15.46" y2="14"/>
          </svg>
          <span class="cvd-preview-title">Color Blindness Preview</span>
        </div>
        <div class="cvd-preview-grid" id="cvd-preview-grid">
          <!-- Previews will be generated by JS -->
        </div>
      </div>

      <!-- CVD Simulation Info (shown when simulation active) -->
      <div class="cvd-simulation-info" id="cvd-simulation-info" style="display: none;">
        <div class="cvd-info-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="12" cy="12" r="4"/>
            <line x1="21.17" y1="8" x2="12" y2="8"/>
            <line x1="3.95" y1="6.06" x2="8.54" y2="14"/>
            <line x1="10.88" y1="21.94" x2="15.46" y2="14"/>
          </svg>
          <span class="cvd-info-title"><span id="cvd-mode-name">-</span> Simulation Active</span>
        </div>
        <p class="cvd-info-description">The page is being filtered. The colors you see above show how your selected colors appear to someone with this type of color vision deficiency.</p>
        <div class="cvd-simulated-colors">
          <div class="cvd-color-pair">
            <span class="cvd-color-label">Perceived FG:</span>
            <code class="cvd-color-hex" id="cvd-fg-hex">-</code>
          </div>
          <div class="cvd-color-pair">
            <span class="cvd-color-label">Perceived BG:</span>
            <code class="cvd-color-hex" id="cvd-bg-hex">-</code>
          </div>
          <div class="cvd-color-pair cvd-ratio-pair">
            <span class="cvd-color-label">Perceived Ratio:</span>
            <code class="cvd-color-hex" id="cvd-ratio">-</code>
          </div>
        </div>
      </div>

    </div>

    <!-- Results Panel -->
    <div class="results-card card">
      <div class="ratio-display">
        <span class="ratio-value" id="contrast-ratio">21.00</span>
        <span class="ratio-suffix">:1</span>
      </div>

      <div class="compliance-grid">
        <div class="compliance-item" id="normal-aa">
          <span class="compliance-label">Normal Text AA</span>
          <span class="compliance-req">(4.5:1)</span>
          <span class="badge badge-success">Pass</span>
        </div>
        <div class="compliance-item" id="normal-aaa">
          <span class="compliance-label">Normal Text AAA</span>
          <span class="compliance-req">(7:1)</span>
          <span class="badge badge-success">Pass</span>
        </div>
        <div class="compliance-item" id="large-aa">
          <span class="compliance-label">Large Text AA</span>
          <span class="compliance-req">(3:1)</span>
          <span class="badge badge-success">Pass</span>
        </div>
        <div class="compliance-item" id="large-aaa">
          <span class="compliance-label">Large Text AAA</span>
          <span class="compliance-req">(4.5:1)</span>
          <span class="badge badge-success">Pass</span>
        </div>
        <div class="compliance-item" id="ui-components">
          <span class="compliance-label">UI Components</span>
          <span class="compliance-req">(3:1)</span>
          <span class="badge badge-success">Pass</span>
        </div>
      </div>
    </div>

    <!-- Live Preview -->
    <div class="preview-card card" id="preview-card">
      <div class="preview-content" id="preview-content">
        <h3 class="preview-heading">Live Preview</h3>
        <p class="preview-normal">
          This is how normal text (16px) appears with your color combination.
          Good contrast ensures readability for all users.
        </p>
        <p class="preview-large">Large text preview (18px+ bold or 24px+)</p>
        <div class="preview-ui">
          <button class="preview-button">Button</button>
          <span class="preview-link">Link Text</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Fixed Suggestions Panel -->
  <div class="suggestions-panel" id="suggestions-panel" style="display: none;">
    <div class="suggestions-header">
      <h4 class="suggestions-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4M12 8h.01"/>
        </svg>
        Suggested Alternatives
      </h4>
      <p class="suggestions-text">Click to apply</p>
    </div>
    <div class="suggestions-grid" id="suggestions-grid">
      <!-- Suggestions will be inserted here -->
    </div>
  </div>
</section>

<script>
  import {
    hexToRgb,
    rgbToHex,
    getContrastRatio,
    checkWCAGCompliance,
    findPassingColor,
    generateAccessiblePair,
    isValidHex,
    normalizeHex,
    WCAG_THRESHOLDS,
  } from '../scripts/contrast';
  import { simulateCVD, getCurrentCVDMode, CVD_TYPES } from '../scripts/color-blindness';
  import type { CVDType } from '../scripts/color-blindness';

  // DOM Elements
  const foregroundInput = document.getElementById('foreground-color') as HTMLInputElement;
  const foregroundPicker = document.getElementById('foreground-picker') as HTMLInputElement;
  const backgroundInput = document.getElementById('background-color') as HTMLInputElement;
  const backgroundPicker = document.getElementById('background-picker') as HTMLInputElement;
  const swapBtn = document.getElementById('swap-colors') as HTMLButtonElement;
  const randomBtn = document.getElementById('random-pair') as HTMLButtonElement;
  const addToPaletteBtn = document.getElementById('add-to-palette') as HTMLButtonElement;

  const ratioDisplay = document.getElementById('contrast-ratio') as HTMLElement;
  const previewCard = document.getElementById('preview-card') as HTMLElement;
  const previewContent = document.getElementById('preview-content') as HTMLElement;

  const normalAA = document.getElementById('normal-aa') as HTMLElement;
  const normalAAA = document.getElementById('normal-aaa') as HTMLElement;
  const largeAA = document.getElementById('large-aa') as HTMLElement;
  const largeAAA = document.getElementById('large-aaa') as HTMLElement;
  const uiComponents = document.getElementById('ui-components') as HTMLElement;

  const suggestionsPanel = document.getElementById('suggestions-panel') as HTMLElement;
  const suggestionsGrid = document.getElementById('suggestions-grid') as HTMLElement;

  // CVD elements
  const cvdPreviewPanel = document.getElementById('cvd-preview-panel') as HTMLElement;
  const cvdPreviewGrid = document.getElementById('cvd-preview-grid') as HTMLElement;
  const cvdSimulationInfo = document.getElementById('cvd-simulation-info') as HTMLElement;
  const cvdModeName = document.getElementById('cvd-mode-name') as HTMLElement;
  const cvdFgHex = document.getElementById('cvd-fg-hex') as HTMLElement;
  const cvdBgHex = document.getElementById('cvd-bg-hex') as HTMLElement;
  const cvdRatio = document.getElementById('cvd-ratio') as HTMLElement;

  /**
   * Update the badge in a compliance item
   */
  function updateBadge(element: HTMLElement, passes: boolean): void {
    const badge = element.querySelector('.badge') as HTMLElement;
    badge.className = `badge ${passes ? 'badge-success' : 'badge-error'}`;
    badge.textContent = passes ? 'Pass' : 'Fail';
  }

  /**
   * Generate suggestions for passing colors
   */
  function generateSuggestions(fg: string, bg: string): void {
    const fgRgb = hexToRgb(fg);
    const bgRgb = hexToRgb(bg);

    if (!fgRgb || !bgRgb) return;

    const ratio = getContrastRatio(fgRgb, bgRgb);

    if (ratio >= WCAG_THRESHOLDS.normalTextAA) {
      suggestionsPanel.style.display = 'none';
      return;
    }

    suggestionsPanel.style.display = 'block';
    suggestionsGrid.innerHTML = '';

    // Find passing foreground color
    const passingFg = findPassingColor(fgRgb, bgRgb, WCAG_THRESHOLDS.normalTextAA);
    if (passingFg) {
      const passingFgHex = rgbToHex(passingFg);
      const newRatio = getContrastRatio(passingFg, bgRgb);

      const suggestion = document.createElement('button');
      suggestion.className = 'suggestion-item';
      suggestion.innerHTML = `
        <div class="suggestion-preview" style="background: ${bg}; color: ${passingFgHex};">Aa</div>
        <div class="suggestion-info">
          <span class="suggestion-color">${passingFgHex}</span>
          <span class="suggestion-ratio">${newRatio.toFixed(2)}:1</span>
        </div>
      `;
      suggestion.addEventListener('click', () => {
        foregroundInput.value = passingFgHex;
        foregroundPicker.value = passingFgHex;
        updateContrastCheck();
      });
      suggestionsGrid.appendChild(suggestion);
    }

    // Find passing background color
    const passingBg = findPassingColor(bgRgb, fgRgb, WCAG_THRESHOLDS.normalTextAA);
    if (passingBg) {
      const passingBgHex = rgbToHex(passingBg);
      const newRatio = getContrastRatio(fgRgb, passingBg);

      const suggestion = document.createElement('button');
      suggestion.className = 'suggestion-item';
      suggestion.innerHTML = `
        <div class="suggestion-preview" style="background: ${passingBgHex}; color: ${fg};">Aa</div>
        <div class="suggestion-info">
          <span class="suggestion-color">${passingBgHex}</span>
          <span class="suggestion-ratio">${newRatio.toFixed(2)}:1</span>
        </div>
      `;
      suggestion.addEventListener('click', () => {
        backgroundInput.value = passingBgHex;
        backgroundPicker.value = passingBgHex;
        updateContrastCheck();
      });
      suggestionsGrid.appendChild(suggestion);
    }
  }

  /**
   * Main update function
   */
  function updateContrastCheck(): void {
    const fg = normalizeHex(foregroundInput.value);
    const bg = normalizeHex(backgroundInput.value);

    const fgRgb = hexToRgb(fg);
    const bgRgb = hexToRgb(bg);

    if (!fgRgb || !bgRgb) return;

    // Calculate contrast
    const ratio = getContrastRatio(fgRgb, bgRgb);
    const compliance = checkWCAGCompliance(ratio);

    // Update ratio display
    ratioDisplay.textContent = ratio.toFixed(2);

    // Update compliance badges
    updateBadge(normalAA, compliance.normalTextAA);
    updateBadge(normalAAA, compliance.normalTextAAA);
    updateBadge(largeAA, compliance.largeTextAA);
    updateBadge(largeAAA, compliance.largeTextAAA);
    updateBadge(uiComponents, compliance.uiComponents);

    // Update preview
    previewCard.style.setProperty('--preview-bg', bg);
    previewCard.style.setProperty('--preview-fg', fg);
    previewContent.style.backgroundColor = bg;
    previewContent.style.color = fg;

    // Generate suggestions if needed
    generateSuggestions(fg, bg);

    // Update CVD simulation info
    updateCVDSimulation(fg, bg);

    // Dispatch custom event for palette integration
    window.dispatchEvent(new CustomEvent('contrastUpdate', {
      detail: { foreground: fg, background: bg, ratio, compliance }
    }));
  }

  /**
   * Update CVD preview panel (when no simulation active)
   */
  function updateCVDPreview(fg: string, bg: string): void {
    cvdPreviewGrid.innerHTML = '';

    CVD_TYPES.forEach(cvdType => {
      const simulatedFg = simulateCVD(fg, cvdType.id);
      const simulatedBg = simulateCVD(bg, cvdType.id);

      // Calculate simulated contrast ratio
      const simFgRgb = hexToRgb(simulatedFg);
      const simBgRgb = hexToRgb(simulatedBg);
      let simRatio = 0;
      if (simFgRgb && simBgRgb) {
        simRatio = getContrastRatio(simFgRgb, simBgRgb);
      }

      const previewItem = document.createElement('div');
      previewItem.className = 'cvd-preview-item';
      previewItem.innerHTML = `
        <div class="cvd-preview-swatch" style="background: ${simulatedBg}; color: ${simulatedFg};">Aa</div>
        <div class="cvd-preview-info">
          <span class="cvd-preview-name">${cvdType.name}</span>
          <span class="cvd-preview-ratio ${simRatio >= 4.5 ? 'ratio-pass' : 'ratio-fail'}">${simRatio.toFixed(1)}:1</span>
        </div>
      `;
      cvdPreviewGrid.appendChild(previewItem);
    });
  }

  /**
   * Update CVD simulation info panel (when simulation active)
   */
  function updateCVDSimulation(fg: string, bg: string): void {
    const mode = getCurrentCVDMode();

    if (mode === 'none') {
      // Show preview panel, hide simulation info
      cvdPreviewPanel.style.display = 'block';
      cvdSimulationInfo.style.display = 'none';
      updateCVDPreview(fg, bg);
      return;
    }

    // Hide preview panel, show simulation info
    cvdPreviewPanel.style.display = 'none';
    cvdSimulationInfo.style.display = 'block';

    const cvdInfo = CVD_TYPES.find(t => t.id === mode);
    cvdModeName.textContent = cvdInfo?.name || mode;

    // Simulate colors
    const simulatedFg = simulateCVD(fg, mode);
    const simulatedBg = simulateCVD(bg, mode);

    // Update hex values
    cvdFgHex.textContent = simulatedFg;
    cvdBgHex.textContent = simulatedBg;

    // Calculate simulated contrast ratio
    const simFgRgb = hexToRgb(simulatedFg);
    const simBgRgb = hexToRgb(simulatedBg);
    if (simFgRgb && simBgRgb) {
      const simRatio = getContrastRatio(simFgRgb, simBgRgb);
      cvdRatio.textContent = `${simRatio.toFixed(2)}:1`;
    }
  }

  /**
   * Handle text input changes
   */
  function handleTextInput(input: HTMLInputElement, picker: HTMLInputElement): void {
    let value = input.value.trim();

    // Auto-add hash if missing
    if (value && !value.startsWith('#')) {
      value = '#' + value;
    }

    if (isValidHex(value)) {
      const normalized = normalizeHex(value);
      input.value = normalized;
      picker.value = normalized;
      input.classList.remove('input-error');
      updateContrastCheck();
    } else if (value.length >= 4) {
      input.classList.add('input-error');
    }
  }

  /**
   * Handle color picker changes
   */
  function handlePickerChange(picker: HTMLInputElement, input: HTMLInputElement): void {
    input.value = picker.value.toUpperCase();
    input.classList.remove('input-error');
    updateContrastCheck();
  }

  // Event listeners - Text inputs
  foregroundInput.addEventListener('input', () => handleTextInput(foregroundInput, foregroundPicker));
  backgroundInput.addEventListener('input', () => handleTextInput(backgroundInput, backgroundPicker));

  // Event listeners - Color pickers
  foregroundPicker.addEventListener('input', () => handlePickerChange(foregroundPicker, foregroundInput));
  backgroundPicker.addEventListener('input', () => handlePickerChange(backgroundPicker, backgroundInput));

  // Swap colors
  swapBtn.addEventListener('click', () => {
    const fg = foregroundInput.value;
    const bg = backgroundInput.value;

    foregroundInput.value = bg;
    foregroundPicker.value = bg;
    backgroundInput.value = fg;
    backgroundPicker.value = fg;

    updateContrastCheck();
  });

  // Random accessible pair
  randomBtn.addEventListener('click', () => {
    const pair = generateAccessiblePair();

    foregroundInput.value = pair.foreground.toUpperCase();
    foregroundPicker.value = pair.foreground;
    backgroundInput.value = pair.background.toUpperCase();
    backgroundPicker.value = pair.background;

    updateContrastCheck();
  });

  // Add to palette
  addToPaletteBtn.addEventListener('click', () => {
    const fg = normalizeHex(foregroundInput.value);
    const bg = normalizeHex(backgroundInput.value);

    window.dispatchEvent(new CustomEvent('addToPalette', {
      detail: { foreground: fg, background: bg }
    }));
  });

  // Listen for CVD mode changes
  window.addEventListener('cvdModeChange', () => {
    updateContrastCheck();
  });

  // Initial update
  updateContrastCheck();
</script>

<style is:global>
  .contrast-checker {
    padding: var(--space-8) 0;
  }

  .tool-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .tool-title {
    font-size: var(--text-3xl);
    margin-bottom: var(--space-3);
  }

  .tool-description {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 500px;
    margin: 0 auto;
  }

  .checker-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: var(--space-6);
  }

  /* Color Inputs Card */
  .color-inputs-card {
    grid-column: 1;
    grid-row: 1;
  }

  .color-inputs {
    display: flex;
    align-items: flex-end;
    gap: var(--space-4);
    margin-bottom: var(--space-6);
  }

  .color-input-group {
    flex: 1;
  }

  .color-label {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    margin-bottom: var(--space-2);
  }

  .label-text {
    font-weight: 500;
    color: var(--color-text-primary);
  }

  .label-hint {
    font-size: var(--text-xs);
    color: var(--color-text-tertiary);
  }

  .color-input-wrapper {
    display: flex;
    gap: var(--space-2);
    align-items: center;
  }

  .color-picker {
    width: 48px;
    height: 48px;
    padding: 0;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    background: transparent;
    overflow: hidden;
  }

  .color-picker::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  .color-picker::-webkit-color-swatch {
    border: none;
    border-radius: var(--radius-sm);
  }

  .color-hex-input {
    flex: 1;
    text-transform: uppercase;
    font-family: var(--font-mono);
  }

  .color-hex-input.input-error {
    border-color: var(--color-error);
  }

  .swap-btn {
    flex-shrink: 0;
    margin-bottom: 4px;
  }

  .action-buttons {
    display: flex;
    gap: var(--space-3);
  }

  .action-buttons .btn {
    flex: 1;
  }

  /* CVD Preview Panel (shown when no simulation active) */
  .cvd-preview-panel {
    margin-top: var(--space-5);
    padding: var(--space-4);
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
  }

  .cvd-preview-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
    color: var(--color-text-secondary);
  }

  .cvd-preview-title {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .cvd-preview-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-3);
  }

  .cvd-preview-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
  }

  .cvd-preview-swatch {
    width: 100%;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-lg);
    font-weight: 700;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
  }

  .cvd-preview-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }

  .cvd-preview-name {
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    font-weight: 500;
  }

  .cvd-preview-ratio {
    font-size: var(--text-xs);
    font-family: var(--font-mono);
    font-weight: 600;
  }

  .cvd-preview-ratio.ratio-pass {
    color: var(--color-success);
  }

  .cvd-preview-ratio.ratio-fail {
    color: var(--color-error);
  }

  /* CVD Simulation Info (shown when simulation active) */
  .cvd-simulation-info {
    margin-top: var(--space-5);
    padding: var(--space-4);
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-accent);
    border-radius: var(--radius-md);
  }

  .cvd-info-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
    color: var(--color-accent);
  }

  .cvd-info-title {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .cvd-info-description {
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-3) 0;
    line-height: var(--leading-relaxed);
  }

  .cvd-simulated-colors {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-4);
  }

  .cvd-color-pair {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .cvd-color-label {
    font-size: var(--text-xs);
    color: var(--color-text-tertiary);
    font-weight: 500;
  }

  .cvd-color-hex {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    background: var(--color-bg-secondary);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
  }

  .cvd-ratio-pair .cvd-color-hex {
    color: var(--color-text-primary);
    font-weight: 600;
  }

  /* Results Card */
  .results-card {
    grid-column: 2;
    grid-row: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .ratio-display {
    display: flex;
    align-items: baseline;
    justify-content: center;
    margin-bottom: var(--space-6);
  }

  .ratio-value {
    font-size: 4rem;
    font-weight: 700;
    font-family: var(--font-mono);
    line-height: 1;
    background: linear-gradient(135deg, var(--color-accent) 0%, #a855f7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .ratio-suffix {
    font-size: var(--text-2xl);
    color: var(--color-text-tertiary);
    margin-left: var(--space-2);
  }

  .compliance-grid {
    display: grid;
    gap: var(--space-3);
    width: 100%;
  }

  .compliance-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    background: var(--color-bg-tertiary);
    border-radius: var(--radius-md);
  }

  .compliance-label {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-primary);
  }

  .compliance-req {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    margin-right: auto;
  }

  /* Preview Card */
  .preview-card {
    grid-column: 1 / -1;
    grid-row: 2;
    padding: 0;
    overflow: hidden;
  }

  .preview-content {
    padding: var(--space-8);
    transition: background-color var(--transition-base), color var(--transition-base);
  }

  .preview-heading {
    font-size: var(--text-xl);
    margin-bottom: var(--space-4);
    color: inherit;
  }

  .preview-normal {
    font-size: var(--text-base);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-4);
    color: inherit;
  }

  .preview-large {
    font-size: var(--text-xl);
    font-weight: 600;
    margin-bottom: var(--space-4);
    color: inherit;
  }

  .preview-ui {
    display: flex;
    gap: var(--space-4);
    align-items: center;
  }

  .preview-button {
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
    font-weight: 500;
    color: inherit;
    background: transparent;
    border: 2px solid currentColor;
    border-radius: var(--radius-md);
    cursor: pointer;
  }

  .preview-link {
    color: inherit;
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  /* Suggestions Panel - Fixed bottom */
  .suggestions-panel {
    position: fixed;
    bottom: var(--space-6);
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    padding: var(--space-4) var(--space-6);
    border-radius: var(--radius-xl);
    border: 1px solid var(--color-warning);
    background: var(--color-bg-elevated);
    box-shadow: var(--shadow-xl), 0 0 0 1px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(12px);
    max-width: 90vw;
    animation: slideUp var(--transition-base) ease-out;
  }

  .suggestions-header {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-3);
  }

  .suggestions-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-warning);
    margin: 0;
  }

  .suggestions-text {
    font-size: var(--text-xs);
    color: var(--color-text-tertiary);
    margin: 0;
  }

  .suggestions-grid {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    justify-content: center;
  }

  .suggestion-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
  }

  .suggestion-item:hover {
    border-color: var(--color-accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .suggestion-preview {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-lg);
    font-weight: 700;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
  }

  .suggestion-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .suggestion-color {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text-primary);
  }

  .suggestion-ratio {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-success);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .checker-grid {
      grid-template-columns: 1fr;
    }

    .color-inputs-card,
    .results-card,
    .preview-card {
      grid-column: 1;
    }

    .results-card {
      grid-row: 2;
    }

    .preview-card {
      grid-row: 3;
    }

    .color-inputs {
      flex-direction: column;
      align-items: stretch;
    }

    .swap-btn {
      align-self: center;
      transform: rotate(90deg);
      margin: var(--space-2) 0;
    }

    .ratio-value {
      font-size: 3rem;
    }

    .cvd-preview-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
